rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Fonction helper pour vérifier l'authentification
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // USERS - Tous les utilisateurs authentifiés peuvent lire
    match /users/{userId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated();
      allow update: if isAuthenticated() && (request.auth.uid == userId || request.auth != null);
      allow delete: if isAuthenticated();
    }
    
    // INTERVENTIONS - Accès complet pour authentifiés
    match /interventions/{interventionId} {
      allow read, write: if isAuthenticated();
    }
    
    // BLOCKED ROOMS - Accès complet pour authentifiés
    match /blockedRooms/{roomId} {
      allow read, write: if isAuthenticated();
    }
    
    // DROPDOWNS - Accès complet pour authentifiés
    match /dropdowns/{category} {
      allow read, write: if isAuthenticated();
    }
    
    // DROPDOWN OPTIONS - Accès complet pour authentifiés
    match /dropdownOptions/{optionId} {
      allow read, write: if isAuthenticated();
    }
    
    // ADMIN OPTIONS - Accès complet pour authentifiés
    match /adminOptions/{category} {
      allow read, write: if isAuthenticated();
    }
    
    // ADMIN DATA - Accès complet pour authentifiés
    match /adminData/{dataId} {
      allow read, write: if isAuthenticated();
    }
    
    // SETTINGS - Accès complet pour authentifiés
    match /settings/{settingId} {
      allow read, write: if isAuthenticated();
    }
    
    // ANALYTICS - Accès complet pour authentifiés
    match /analytics/{docId} {
      allow read, write: if isAuthenticated();
    }
    
    // AUDIT LOGS - Accès complet pour authentifiés
    match /auditLogs/{logId} {
      allow read, write: if isAuthenticated();
    }
    
    // Toutes les autres collections possibles
    match /{document=**} {
      allow read, write: if isAuthenticated();
    }
  }
}